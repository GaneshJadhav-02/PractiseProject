// blurhash@2.0.5 downloaded from https://ga.jspm.io/npm:blurhash@2.0.5/dist/esm/index.js

var t=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],x=e=>{let r=0;for(let a=0;a<e.length;a++){let l=e[a],o=t.indexOf(l);r=83*r+o}return r},p=(e,r)=>{var a="";for(let l=1;l<=r;l++){let o=Math.floor(e)/Math.pow(83,r-l)%83;a+=t[Math.floor(o)]}return a};var f=t=>{let e=t/255;return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)},h=t=>{let e=Math.max(0,Math.min(1,t));return e<=.0031308?Math.trunc(12.92*e*255+.5):Math.trunc(255*(1.055*Math.pow(e,.4166666666666667)-.055)+.5)},F=t=>t<0?-1:1,M=(t,e)=>F(t)*Math.pow(Math.abs(t),e);var e=class extends Error{constructor(t){super(t),this.name="ValidationError",this.message=t}};var C=t=>{if(!t||t.length<6)throw new e("The blurhash string must be at least 6 characters");let r=x(t[0]),a=Math.floor(r/9)+1,l=r%9+1;if(t.length!==4+2*l*a)throw new e(`blurhash length mismatch: length is ${t.length} but it should be ${4+2*l*a}`)},N=t=>{try{C(t)}catch(t){return{result:!1,errorReason:t.message}}return{result:!0}},z=t=>{let e=t>>16,r=t>>8&255,a=255&t;return[f(e),f(r),f(a)]},L=(t,e)=>{let r=Math.floor(t/361),a=Math.floor(t/19)%19,l=t%19;return[M((r-9)/9,2)*e,M((a-9)/9,2)*e,M((l-9)/9,2)*e]},U=(t,e,r,a)=>{C(t),a|=1;let l=x(t[0]),o=Math.floor(l/9)+1,n=l%9+1,s=(x(t[1])+1)/166,i=new Array(n*o);for(let e=0;e<i.length;e++)if(0===e){let r=x(t.substring(2,6));i[e]=z(r)}else{let r=x(t.substring(4+2*e,6+2*e));i[e]=L(r,s*a)}let u=4*e,m=new Uint8ClampedArray(u*r);for(let t=0;t<r;t++)for(let a=0;a<e;a++){let l=0,s=0,c=0;for(let u=0;u<o;u++)for(let o=0;o<n;o++){let m=Math.cos(Math.PI*a*o/e)*Math.cos(Math.PI*t*u/r),g=i[o+u*n];l+=g[0]*m,s+=g[1]*m,c+=g[2]*m}let g=h(l),w=h(s),d=h(c);m[4*a+0+t*u]=g,m[4*a+1+t*u]=w,m[4*a+2+t*u]=d,m[4*a+3+t*u]=255}return m},r=U;var a=4,D=(t,e,r,l)=>{let o=0,n=0,s=0,i=e*a;for(let u=0;u<e;u++){let e=a*u;for(let a=0;a<r;a++){let r=e+a*i,m=l(u,a);o+=m*f(t[r]),n+=m*f(t[r+1]),s+=m*f(t[r+2])}}let u=1/(e*r);return[o*u,n*u,s*u]},$=t=>{let e=h(t[0]),r=h(t[1]),a=h(t[2]);return(e<<16)+(r<<8)+a},H=(t,e)=>{let r=Math.floor(Math.max(0,Math.min(18,Math.floor(9*M(t[0]/e,.5)+9.5)))),a=Math.floor(Math.max(0,Math.min(18,Math.floor(9*M(t[1]/e,.5)+9.5)))),l=Math.floor(Math.max(0,Math.min(18,Math.floor(9*M(t[2]/e,.5)+9.5))));return 19*r*19+19*a+l},O=(t,r,a,l,o)=>{if(l<1||l>9||o<1||o>9)throw new e("BlurHash must have between 1 and 9 components");if(r*a*4!==t.length)throw new e("Width and height must match the pixels array");let n=[];for(let e=0;e<o;e++)for(let o=0;o<l;o++){let l=0==o&&0==e?1:2,s=D(t,r,a,((t,n)=>l*Math.cos(Math.PI*o*t/r)*Math.cos(Math.PI*e*n/a)));n.push(s)}let s=n[0],i=n.slice(1),u="",m=l-1+9*(o-1);u+=p(m,1);let c;if(i.length>0){let t=Math.max(...i.map((t=>Math.max(...t)))),e=Math.floor(Math.max(0,Math.min(82,Math.floor(166*t-.5))));c=(e+1)/166,u+=p(e,1)}else c=1,u+=p(0,1);return u+=p($(s),4),i.forEach((t=>{u+=p(H(t,c),2)})),u},l=O;export{e as ValidationError,r as decode,l as encode,N as isBlurhashValid};

